From b0b67943cd7159a1d37e097e24bf8fa7ef734883 Mon Sep 17 00:00:00 2001
From: Prachi Gupta <pragupta@us.ibm.com>
Date: Wed, 30 Nov 2016 11:01:45 -0600
Subject: [PATCH] processMrw: Fix i2c bus speed array

Change-Id: Ibdbceef278306bc4c8e6153761adf5ffdb332abd
---
 src/usr/targeting/common/processMrw.pl | 31 ++++++++++++++++++-------------
 1 file changed, 18 insertions(+), 13 deletions(-)

diff --git a/src/usr/targeting/common/processMrw.pl b/src/usr/targeting/common/processMrw.pl
index bf401a5..6e89bb8 100644
--- a/src/usr/targeting/common/processMrw.pl
+++ b/src/usr/targeting/common/processMrw.pl
@@ -553,15 +553,19 @@ sub processI2cSpeeds
     $bus_speeds[0][0] = $bus_speeds2[0];
     $bus_speeds[0][1] = $bus_speeds2[1];
     $bus_speeds[0][2] = $bus_speeds2[2];
-    $bus_speeds[1][0] = $bus_speeds2[3];
-    $bus_speeds[1][1] = $bus_speeds2[4];
-    $bus_speeds[1][2] = $bus_speeds2[5];
-    $bus_speeds[2][0] = $bus_speeds2[6];
-    $bus_speeds[2][1] = $bus_speeds2[7];
-    $bus_speeds[2][2] = $bus_speeds2[8];
-    $bus_speeds[3][0] = $bus_speeds2[9];
-    $bus_speeds[3][1] = $bus_speeds2[10];
-    $bus_speeds[3][2] = $bus_speeds2[11];
+    $bus_speeds[0][3] = $bus_speeds2[3];
+    $bus_speeds[1][0] = $bus_speeds2[4];
+    $bus_speeds[1][1] = $bus_speeds2[5];
+    $bus_speeds[1][2] = $bus_speeds2[6];
+    $bus_speeds[1][3] = $bus_speeds2[7];
+    $bus_speeds[2][0] = $bus_speeds2[8];
+    $bus_speeds[2][1] = $bus_speeds2[9];
+    $bus_speeds[2][2] = $bus_speeds2[10];
+    $bus_speeds[2][3] = $bus_speeds2[11];
+    $bus_speeds[3][0] = $bus_speeds2[12];
+    $bus_speeds[3][1] = $bus_speeds2[13];
+    $bus_speeds[3][2] = $bus_speeds2[14];
+    $bus_speeds[3][3] = $bus_speeds2[15];
 
     my $i2cs=$targetObj->findConnections($target,"I2C","");
     if ($i2cs ne "") {
@@ -572,13 +576,10 @@ sub processI2cSpeeds
             my $bus_speed=$targetObj->getBusAttribute(
                   $i2c->{SOURCE},$i2c->{BUS_NUM},"I2C_SPEED");
 
-            #@todo RTC:164224 > currently the bus_speed fields are empty in the xml
-=begin
             if ($bus_speed eq "" || $bus_speed==0) {
                 print "ERROR: I2C bus speed not defined for $i2c->{SOURCE}\n";
                 $targetObj->myExit(3);
             }
-=cut
             ## choose lowest bus speed
             if ($bus_speeds[$engine][$port] eq "" ||
                   $bus_speeds[$engine][$port]==0  ||
@@ -590,15 +591,19 @@ sub processI2cSpeeds
     $bus_speed_attr = $bus_speeds[0][0].",".
                       $bus_speeds[0][1].",".
                       $bus_speeds[0][2].",".
+                      $bus_speeds[0][3].",".
                       $bus_speeds[1][0].",".
                       $bus_speeds[1][1].",".
                       $bus_speeds[1][2].",".
+                      $bus_speeds[1][3].",".
                       $bus_speeds[2][0].",".
                       $bus_speeds[2][1].",".
                       $bus_speeds[2][2].",".
+                      $bus_speeds[2][3].",".
                       $bus_speeds[3][0].",".
                       $bus_speeds[3][1].",".
-                      $bus_speeds[3][2];
+                      $bus_speeds[3][2].",".
+                      $bus_speeds[3][3];
 
     $targetObj->setAttribute($target,"I2C_BUS_SPEED_ARRAY",$bus_speed_attr);
 }
-- 
1.8.2.2

